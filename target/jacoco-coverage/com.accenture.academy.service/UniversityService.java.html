<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UniversityService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Lab</a> &gt; <a href="index.source.html" class="el_package">com.accenture.academy.service</a> &gt; <span class="el_source">UniversityService.java</span></div><h1>UniversityService.java</h1><pre class="source lang-java linenums">package com.accenture.academy.service;

import java.time.LocalDate;
import java.time.Period;
import java.util.List;
import java.util.concurrent.ThreadLocalRandom;

import com.accenture.academy.exception.BusinessException;
import com.accenture.academy.exception.ModuleNotFoundException;
import com.accenture.academy.model.Student;
import com.accenture.academy.model.University;
import com.accenture.academy.utils.AppParametersUtils;
import com.accenture.academy.utils.Module;

/**
 * Service providing university facilities and administrative services.
 * 
 * @author davinen.s.curoopen
 */
<span class="nc" id="L20">public class UniversityService {</span>

	/**
	 * creating a static variable for an object is a VERY bad practice. This a an
	 * exception to avoid increasing the complexity of the lab by add a Repository
	 * layer.
	 */

<span class="fc" id="L28">	public static University university = new University();</span>

	/**
	 * Register a student in the university database.
	 * 
	 * @param firstName
	 *            student's first name
	 * @param lastName
	 *            student's last name
	 * @param dob
	 *            student date of birth
	 * @param acnAcademyStudent
	 *            flag indicating whether student is an acn academy student.
	 * @return a registered student
	 */
	public static Student registerStudent(String firstName, String lastName, LocalDate dob, Boolean acnAcademyStudent) {

<span class="fc" id="L45">		Student student = new Student();</span>
<span class="fc" id="L46">		student.setFirstName(firstName);</span>
<span class="fc" id="L47">		student.setLastName(lastName);</span>
<span class="fc" id="L48">		student.setDob(dob);</span>
<span class="fc" id="L49">		student.setAcnAcademyStudent(acnAcademyStudent);</span>

		// calculating age of the student.
<span class="fc" id="L52">		LocalDate now = LocalDate.of(2018, 5, 8);</span>
<span class="fc" id="L53">		Period period = Period.between(dob, now);</span>

<span class="fc" id="L55">		student.setAge(period.getYears());</span>

		int studentId;
		// generating a student id.
		do {
<span class="fc" id="L60">			studentId = (int) ThreadLocalRandom.current().nextLong(AppParametersUtils.STUDENT_ID_FLOOR,</span>
					AppParametersUtils.STUDENT_ID_CEILING + 1);
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">		} while (university.getCurrentStudent().containsKey(studentId));</span>

<span class="fc" id="L64">		student.setId(studentId);</span>
<span class="fc" id="L65">		university.addStudent(student);</span>
<span class="fc" id="L66">		return student;</span>

	}

	/**
	 * Enroll modules for the specified student.
	 * 
	 * @param studentId
	 *            the unique identifier of the student
	 * @param moduleNames
	 *            modules to be registered for the student
	 * @throws ModuleNotFoundException
	 * @throws BusinessException 
	 */
	public static void enrollModules(Integer studentId, List&lt;String&gt; moduleNames) throws ModuleNotFoundException, BusinessException {
		
<span class="fc" id="L82">		Student student = university.getCurrentStudent().get(studentId);</span>
		
<span class="fc bfc" id="L84" title="All 2 branches covered.">		for (String moduleName : moduleNames) {</span>
<span class="fc" id="L85">			Module module = Module.getModuleByName(moduleName);</span>
			
<span class="fc bfc" id="L87" title="All 2 branches covered.">			if(student.isAcnAcademyStudent()) {</span>
				//module is free
<span class="fc" id="L89">				student.addEnrolledModule(module);</span>
			} else {
<span class="fc" id="L91">				int freeVouchers = student.getFreeModuleVouchers();</span>
				
				//we use the free vouchers.
<span class="fc bfc" id="L94" title="All 2 branches covered.">				if(freeVouchers &gt; 0) {</span>
					//decrementing voucher
<span class="fc" id="L96">					student.setFreeModuleVouchers(freeVouchers -1);</span>
				} else {
<span class="fc" id="L98">					throw new BusinessException(&quot;No module vouchers found. Please purchase more vouchers to enroll additional modules.&quot;);</span>
				}
			}
<span class="fc" id="L101">		}</span>
<span class="fc" id="L102">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>